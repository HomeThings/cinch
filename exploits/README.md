# Instructions for reproducing Cinch's CVE experiment

These exploits run on a Facedancer21. You may purchase one [here](http://int3.cc/products/facedancer21). 

The following steps are to be performed on the attacking machine. The target requires no configuration.

1. Install Facedancer software

  * Install FTDI driver
  
    Directions to install FTDI drivers are [here](http://www.ftdichip.com/Support/Documents/AppNotes/AN_220_FTDI_Drivers_Installation_Guide_for_Linux%20.pdf)
    (may be unnecessary if this driver is already installed).
  
    To verify that the FTDI driver installed and working, plug in facedancer host side and check:

    ``sudo dmesg``

    You should see:

    ```sh
    ftdi_sio 2-2.2:1.0: FTDI USB Serial Device converter detected
    usb 2-2.2: Detected FT232RL
    usb 2-2.2: FTDI USB Serial Device converter now attached to ttyUSB0
    ```

  * Follow Facedancer flash instructions [here](http://int3.cc/blogs/news/8217777-flashing-the-facedancer21).



2. Download and install [goodfet](https://github.com/travisgoodspeed/goodfet)

3. Test to make sure goodfet works.

  ```sh
  cd goodfet/client
  sudo board=facedancer21 goodfet.monitor test
  ```

  You should get a "Self-test complete." and the LED of the facedancer21 should light up.


4. Download [umap] (https://github.com/nccgroup/umap)
   
   You need python 3 and pyserial 2.7. Get pyserial from [here](http://pypi.python.org/pypi/pyserial).

   * Install pyserial

      ```sh
      tar -zxf pyserial.2.7
      cd pyserial.2.7
      python3 setup.py install
      ```

      You can find more info about installing pyserial 
      [here](http://pyserial.sourceforge.net/pyserial.html#installation).

5. Test to make sure that umap works. 
See [here](https://github.com/nccgroup/umap/wiki/umap-documentation) for docs. 

  ``sudo python3 umap.py -P /dev/ttyUSB0``

  You should see the umap banner. At this point you can run all the Windows exploits by connecting
  the facedancer21 to a target machine, and passing in the parameters documented in our
  [paper](https://www.usenix.org/system/files/conference/usenixsecurity16/sec16_paper_angel.pdf).

6. Place the desired exploit (e.g., CVE-2016-2185) in goodfet's client folder (goodfet/client) and run the exploit.


  At this point the facedancer21 should be connected to the attacking machine and the target machine.
  In the attacking machine run: 
  
  ``sudo ./CVE-2016-2185.py`` 


7. The exploit for CVE-2016-3951 requires an extra step.

  Since it overrides the functionality of goodfet's keyboard class, you need to replace the existing file.
  Back up the existing USBKeyboard.py file (or don't, it's a git repo so you can always get it back anyway).

  ```sh
  cp USBKeyboard.py USBKeyboard.py.back
  mv CVE-2016-3951.py USBKeyboard.py
  sudo ./facedancer-keyboard.py
  ```

